=== Pakana Node Azure Appliance Deployment ===
This script will deploy the Pakana Node CE infrastructure to your Azure subscription
and bootstrap the software stack.

Checking Azure login status...

--- Configuration ---
Enter Azure Subscription ID (optional, press Enter to skip if default is set): 
Enter Resource Group Name (e.g., rg-pakana-node): rg-pakana-node-test-9
Enter Region (default: westus3): westus2
Enter Admin Username (default: pakanaadmin): 
Enter SSH Public Key (Press Enter to use default from ~/.ssh/*.pub if available):
~/.ssh/id_pakana_deploy.pub
Reading SSH key from file: /Users/steven/.ssh/id_pakana_deploy.pub
Enter Domain Name (e.g., node.example.com): pakana.lockb0x.io
Enter Admin Email (for SSL certificates): steven@thefirm.codes

Creating Resource Group 'rg-pakana-node-test-9' in 'westus2'...
{
  "id": "/subscriptions/3b7769fd-e52a-4f24-980d-31533dc2c269/resourceGroups/rg-pakana-node-test-9",
  "location": "westus2",
  "managedBy": null,
  "name": "rg-pakana-node-test-9",
  "properties": {
    "provisioningState": "Succeeded"
  },
  "tags": null,
  "type": "Microsoft.Resources/resourceGroups"
}

Validating Bicep Template...
Validation successful.

Deploying Infrastructure (This may take several minutes)...
You can monitor the deployment status in the Azure Portal or by running:
  az deployment group show --resource-group rg-pakana-node-test-9 --name main --query properties.provisioningState
Generated DNS Label: pakana-ce-9424e978
{
  "id": "/subscriptions/3b7769fd-e52a-4f24-980d-31533dc2c269/resourceGroups/rg-pakana-node-test-9/providers/Microsoft.Resources/deployments/main",
  "location": null,
  "name": "main",
  "properties": {
    "correlationId": "29ae774c-fcec-467c-ac93-092185392536",
    "debugSetting": null,
    "dependencies": [
      {
        "dependsOn": [
          {
            "id": "/subscriptions/3b7769fd-e52a-4f24-980d-31533dc2c269/resourceGroups/rg-pakana-node-test-9/providers/Microsoft.Compute/disks/pakana-ce-node-data-disk",
            "resourceGroup": "rg-pakana-node-test-9",
            "resourceName": "pakana-ce-node-data-disk",
            "resourceType": "Microsoft.Compute/disks"
          },
          {
            "id": "/subscriptions/3b7769fd-e52a-4f24-980d-31533dc2c269/resourceGroups/rg-pakana-node-test-9/providers/Microsoft.Network/networkInterfaces/pakana-ce-node-nic",
            "resourceGroup": "rg-pakana-node-test-9",
            "resourceName": "pakana-ce-node-nic",
            "resourceType": "Microsoft.Network/networkInterfaces"
          }
        ],
        "id": "/subscriptions/3b7769fd-e52a-4f24-980d-31533dc2c269/resourceGroups/rg-pakana-node-test-9/providers/Microsoft.Compute/virtualMachines/pakana-ce-node",
        "resourceGroup": "rg-pakana-node-test-9",
        "resourceName": "pakana-ce-node",
        "resourceType": "Microsoft.Compute/virtualMachines"
      },
      {
        "dependsOn": [
          {
            "id": "/subscriptions/3b7769fd-e52a-4f24-980d-31533dc2c269/resourceGroups/rg-pakana-node-test-9/providers/Microsoft.Network/publicIPAddresses/pakana-ce-node-pip",
            "resourceGroup": "rg-pakana-node-test-9",
            "resourceName": "pakana-ce-node-pip",
            "resourceType": "Microsoft.Network/publicIPAddresses"
          },
          {
            "id": "/subscriptions/3b7769fd-e52a-4f24-980d-31533dc2c269/resourceGroups/rg-pakana-node-test-9/providers/Microsoft.Network/virtualNetworks/pakana-ce-node-vnet",
            "resourceGroup": "rg-pakana-node-test-9",
            "resourceName": "pakana-ce-node-vnet",
            "resourceType": "Microsoft.Network/virtualNetworks"
          }
        ],
        "id": "/subscriptions/3b7769fd-e52a-4f24-980d-31533dc2c269/resourceGroups/rg-pakana-node-test-9/providers/Microsoft.Network/networkInterfaces/pakana-ce-node-nic",
        "resourceGroup": "rg-pakana-node-test-9",
        "resourceName": "pakana-ce-node-nic",
        "resourceType": "Microsoft.Network/networkInterfaces"
      },
      {
        "dependsOn": [
          {
            "id": "/subscriptions/3b7769fd-e52a-4f24-980d-31533dc2c269/resourceGroups/rg-pakana-node-test-9/providers/Microsoft.Network/networkSecurityGroups/pakana-ce-node-nsg",
            "resourceGroup": "rg-pakana-node-test-9",
            "resourceName": "pakana-ce-node-nsg",
            "resourceType": "Microsoft.Network/networkSecurityGroups"
          }
        ],
        "id": "/subscriptions/3b7769fd-e52a-4f24-980d-31533dc2c269/resourceGroups/rg-pakana-node-test-9/providers/Microsoft.Network/virtualNetworks/pakana-ce-node-vnet",
        "resourceGroup": "rg-pakana-node-test-9",
        "resourceName": "pakana-ce-node-vnet",
        "resourceType": "Microsoft.Network/virtualNetworks"
      }
    ],
    "diagnostics": null,
    "duration": "PT37.8745351S",
    "error": null,
    "extensions": null,
    "mode": "Incremental",
    "onErrorDeployment": null,
    "outputResources": [
      {
        "apiVersion": null,
        "extension": null,
        "id": "/subscriptions/3b7769fd-e52a-4f24-980d-31533dc2c269/resourceGroups/rg-pakana-node-test-9/providers/Microsoft.Compute/disks/pakana-ce-node-data-disk",
        "identifiers": null,
        "resourceGroup": "rg-pakana-node-test-9",
        "resourceType": null
      },
      {
        "apiVersion": null,
        "extension": null,
        "id": "/subscriptions/3b7769fd-e52a-4f24-980d-31533dc2c269/resourceGroups/rg-pakana-node-test-9/providers/Microsoft.Compute/virtualMachines/pakana-ce-node",
        "identifiers": null,
        "resourceGroup": "rg-pakana-node-test-9",
        "resourceType": null
      },
      {
        "apiVersion": null,
        "extension": null,
        "id": "/subscriptions/3b7769fd-e52a-4f24-980d-31533dc2c269/resourceGroups/rg-pakana-node-test-9/providers/Microsoft.Network/networkInterfaces/pakana-ce-node-nic",
        "identifiers": null,
        "resourceGroup": "rg-pakana-node-test-9",
        "resourceType": null
      },
      {
        "apiVersion": null,
        "extension": null,
        "id": "/subscriptions/3b7769fd-e52a-4f24-980d-31533dc2c269/resourceGroups/rg-pakana-node-test-9/providers/Microsoft.Network/networkSecurityGroups/pakana-ce-node-nsg",
        "identifiers": null,
        "resourceGroup": "rg-pakana-node-test-9",
        "resourceType": null
      },
      {
        "apiVersion": null,
        "extension": null,
        "id": "/subscriptions/3b7769fd-e52a-4f24-980d-31533dc2c269/resourceGroups/rg-pakana-node-test-9/providers/Microsoft.Network/publicIPAddresses/pakana-ce-node-pip",
        "identifiers": null,
        "resourceGroup": "rg-pakana-node-test-9",
        "resourceType": null
      },
      {
        "apiVersion": null,
        "extension": null,
        "id": "/subscriptions/3b7769fd-e52a-4f24-980d-31533dc2c269/resourceGroups/rg-pakana-node-test-9/providers/Microsoft.Network/virtualNetworks/pakana-ce-node-vnet",
        "identifiers": null,
        "resourceGroup": "rg-pakana-node-test-9",
        "resourceType": null
      }
    ],
    "outputs": {
      "fqdn": {
        "type": "String",
        "value": "pakana-ce-9424e978.westus2.cloudapp.azure.com"
      },
      "publicIP": {
        "type": "String",
        "value": "20.9.232.146"
      }
    },
    "parameters": {
      "adminPasswordOrKey": {
        "type": "SecureString"
      },
      "adminUsername": {
        "type": "String",
        "value": "pakanaadmin"
      },
      "dnsLabel": {
        "type": "String",
        "value": "pakana-ce-9424e978"
      },
      "location": {
        "type": "String",
        "value": "westus2"
      },
      "vmName": {
        "type": "String",
        "value": "pakana-ce-node"
      }
    },
    "parametersLink": null,
    "providers": [
      {
        "id": null,
        "namespace": "Microsoft.Network",
        "providerAuthorizationConsentState": null,
        "registrationPolicy": null,
        "registrationState": null,
        "resourceTypes": [
          {
            "aliases": null,
            "apiProfiles": null,
            "apiVersions": null,
            "capabilities": null,
            "defaultApiVersion": null,
            "locationMappings": null,
            "locations": [
              "westus2"
            ],
            "properties": null,
            "resourceType": "publicIPAddresses",
            "zoneMappings": null
          },
          {
            "aliases": null,
            "apiProfiles": null,
            "apiVersions": null,
            "capabilities": null,
            "defaultApiVersion": null,
            "locationMappings": null,
            "locations": [
              "westus2"
            ],
            "properties": null,
            "resourceType": "networkSecurityGroups",
            "zoneMappings": null
          },
          {
            "aliases": null,
            "apiProfiles": null,
            "apiVersions": null,
            "capabilities": null,
            "defaultApiVersion": null,
            "locationMappings": null,
            "locations": [
              "westus2"
            ],
            "properties": null,
            "resourceType": "networkInterfaces",
            "zoneMappings": null
          },
          {
            "aliases": null,
            "apiProfiles": null,
            "apiVersions": null,
            "capabilities": null,
            "defaultApiVersion": null,
            "locationMappings": null,
            "locations": [
              "westus2"
            ],
            "properties": null,
            "resourceType": "virtualNetworks",
            "zoneMappings": null
          }
        ]
      },
      {
        "id": null,
        "namespace": "Microsoft.Compute",
        "providerAuthorizationConsentState": null,
        "registrationPolicy": null,
        "registrationState": null,
        "resourceTypes": [
          {
            "aliases": null,
            "apiProfiles": null,
            "apiVersions": null,
            "capabilities": null,
            "defaultApiVersion": null,
            "locationMappings": null,
            "locations": [
              "westus2"
            ],
            "properties": null,
            "resourceType": "disks",
            "zoneMappings": null
          },
          {
            "aliases": null,
            "apiProfiles": null,
            "apiVersions": null,
            "capabilities": null,
            "defaultApiVersion": null,
            "locationMappings": null,
            "locations": [
              "westus2"
            ],
            "properties": null,
            "resourceType": "virtualMachines",
            "zoneMappings": null
          }
        ]
      }
    ],
    "provisioningState": "Succeeded",
    "templateHash": "10402579780704289980",
    "templateLink": null,
    "timestamp": "2026-01-28T02:47:19.334154+00:00",
    "validatedResources": null,
    "validationLevel": null
  },
  "resourceGroup": "rg-pakana-node-test-9",
  "tags": null,
  "type": "Microsoft.Resources/deployments"
}

=== Infrastructure Deployed ===
VM Public IP: 20.9.232.146
VM Hostname: pakana-ce-9424e978.westus2.cloudapp.azure.com

Configuring System (Disk, Docker, Tuning)...
{
  "value": [
    {
      "code": "ProvisioningState/succeeded",
      "displayStatus": "Provisioning succeeded",
      "level": "Info",
      "message": "Enable succeeded: \n[stdout]\nkernel.sem = 250 32000 100 128\nConfiguring Data Disk...\nCreating filesystem with 67108352 4k blocks and 16777216 inodes\nFilesystem UUID: d9596d09-c553-4a5f-8f1e-78f7f1fa8e0b\nSuperblock backups stored on blocks: \n\t32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208, \n\t4096000, 7962624, 11239424, 20480000, 23887872\n\nAllocating group tables:    0/2048\b\b\b\b\b\b\b\b\b         \b\b\b\b\b\b\b\b\bdone                            \nWriting inode tables:    0/2048\b\b\b\b\b\b\b\b\b         \b\b\b\b\b\b\b\b\bdone                            \nCreating journal (262144 blocks): done\nWriting superblocks and filesystem accounting information:    0/2048\b\b\b\b\b\b\b\b\b         \b\b\b\b\b\b\b\b\bdone\n\n\n[stderr]\nmke2fs 1.47.0 (5-Feb-2023)\nmount: /data: /dev/sdc already mounted or mount point busy.\n       dmesg(1) may have more information after failed mount system call.\n"
    }
  ]
}
Bootstrapping Pakana Software...
{
  "value": [
    {
      "code": "ProvisioningState/succeeded",
      "displayStatus": "Provisioning succeeded",
      "level": "Info",
      "message": "Enable succeeded: \n[stdout]\nRepository already exists.\nStarting YottaDB container...\nInitializing Database...\nDatabase already exists.\nStarting remaining services...\n#1 [internal] load local bake definitions\n#1 reading from stdin 1.33kB done\n#1 DONE 0.0s\n\n#2 [api-report internal] load build definition from Dockerfile\n#2 transferring dockerfile:\n#2 transferring dockerfile: 1.36kB done\n#2 DONE 0.2s\n\n#3 [api-go internal] load build definition from Dockerfile\n#3 transferring dockerfile: 957B done\n#3 DONE 0.2s\n\n#4 [core-rust internal] load build definition from Dockerfile\n#4 transferring dockerfile: 1.10kB done\n#4 DONE 0.2s\n\n#5 [api-report internal] load metadata for docker.io/library/node:20-alpine\n#5 ...\n\n#6 [core-rust internal] load metadata for docker.io/yottadb/yottadb-base:latest-master\n#6 DONE 0.1s\n\n#7 [api-go internal] load .dockerignore\n#7 transferring context: 2B done\n#7 DONE 0.1s\n\n#8 [core-rust internal] load .dockerignore\n#8 transferring context: 59B done\n#8 DONE 0.1s\n\n#9 [api-go internal] load build context\n#9 DONE 0.0s\n\n#10 [core-rust internal] load build context\n#10 DONE 0.0s\n\n#11 [api-go 1/9] FROM docker.io/yottadb/yottadb-base:latest-master@sha256:1a887e94e7e5b9f04e7ea6147663b558d1c2787d63587a35ebf6f0de9a09a9ea\n#11 resolve docker.io/yottadb/yottadb-base:latest-master@sha256:1a887e94e7e5b9f04e7ea6147663b558d1c2787d63587a35ebf6f0de9a09a9ea 0.1s done\n#11 resolve docker.io/yottadb/yottadb-base:latest-master@sha256:1a887e94e7e5b9f04e7ea6147663b558d1c2787d63587a35ebf6f0de9a09a9ea 0.1s done\n#11 ...\n\n#9 [api-go internal] load build context\n#9 transferring context: 14.23kB done\n#9 DONE 0.2s\n\n#10 [core-rust internal] load build context\n#10 transferring context: 37.74kB done\n#10 DONE 0.3s\n\n#12 [api-go 2/9] RUN apt-get update && apt-get install -y wget build-essential pkg-config &&     wget https://go.dev/dl/go1.24.0.linux-amd64.tar.gz &&     tar -C /usr/local -xzf go1.24.0.linux-amd64.tar.gz &&     rm go1.24.0.linux-amd64.tar.gz\n#12 CACHED\n\n#13 [api-go 3/9] WORKDIR /app\n#13 CACHED\n\n#14 [api-go 4/9] COPY go.mod go.sum ./\n#14 ERROR: failed to calculate checksum of ref go2d8k8udu6rmjgvqg18z8wlq::7mnycxyss9wd2eprrkfuk2z43: \"/go.sum\": not found\n\n#11 [api-go 1/9] FROM docker.io/yottadb/yottadb-base:latest-master@sha256:1a887e94e7e5b9f04e7ea6147663b558d1c2787d63587a35ebf6f0de9a09a9ea\n#11 ...\n\n#5 [api-report internal] load metadata for docker.io/library/node:20-alpine\n#5 CANCELED\n\n#15 [core-rust  2/11] RUN apt-get update --fix-missing && apt-get install -y --no-install-recommends curl build-essential pkg-config libssl-dev libclang-dev clang ca-certificates && rm -rf /var/lib/apt/lists/*\n#15 CANCELED\n\n#11 [core-rust 1/9] FROM docker.io/yottadb/yottadb-base:latest-master@sha256:1a887e94e7e5b9f04e7ea6147663b558d1c2787d63587a35ebf6f0de9a09a9ea\n------\n > [api-go 4/9] COPY go.mod go.sum ./:\n------\n\n[stderr]\nad8db4cbfa5d Extracting 2 s\n ad8db4cbfa5d Extracting 2 s\n ad8db4cbfa5d Extracting 2 s\n ad8db4cbfa5d Extracting 2 s\n ad8db4cbfa5d Extracting 2 s\n ad8db4cbfa5d Extracting 2 s\n ad8db4cbfa5d Extracting 2 s\n ad8db4cbfa5d Extracting 2 s\n ad8db4cbfa5d Extracting 2 s\n ad8db4cbfa5d Extracting 2 s\n ad8db4cbfa5d Extracting 2 s\n ad8db4cbfa5d Extracting 2 s\n ad8db4cbfa5d Extracting 2 s\n ad8db4cbfa5d Extracting 2 s\n ad8db4cbfa5d Extracting 3 s\n ad8db4cbfa5d Extracting 3 s\n ad8db4cbfa5d Extracting 3 s\n ad8db4cbfa5d Extracting 3 s\n ad8db4cbfa5d Extracting 3 s\n ad8db4cbfa5d Extracting 3 s\n ad8db4cbfa5d Extracting 3 s\n ad8db4cbfa5d Extracting 3 s\n ad8db4cbfa5d Extracting 3 s\n ad8db4cbfa5d Extracting 3 s\n ad8db4cbfa5d Extracting 3 s\n ad8db4cbfa5d Extracting 3 s\n ad8db4cbfa5d Extracting 3 s\n ad8db4cbfa5d Extracting 3 s\n ad8db4cbfa5d Extracting 3 s\n ad8db4cbfa5d Extracting 3 s\n ad8db4cbfa5d Extracting 3 s\n ad8db4cbfa5d Extracting 3 s\n ad8db4cbfa5d Extracting 3 s\n ad8db4cbfa5d Extracting 4 s\n ad8db4cbfa5d Extracting 3 s\n ad8db4cbfa5d Extracting 4 s\n ad8db4cbfa5d Extracting 4 s\n ad8db4cbfa5d Extracting 4 s\n ad8db4cbfa5d Extracting 4 s\n ad8db4cbfa5d Extracting 4 s\n ad8db4cbfa5d Extracting 4 s\n ad8db4cbfa5d Extracting 4 s\n ad8db4cbfa5d Extracting 4 s\n ad8db4cbfa5d Extracting 4 s\n ad8db4cbfa5d Extracting 4 s\n ad8db4cbfa5d Extracting 4 s\n ad8db4cbfa5d Extracting 4 s\n ad8db4cbfa5d Extracting 4 s\n ad8db4cbfa5d Extracting 4 s\n ad8db4cbfa5d Extracting 4 s\n ad8db4cbfa5d Extracting 4 s\n ad8db4cbfa5d Pull complete \n ad8db4cbfa5d Pull complete \n 13e5c0ceb5f8 Pull complete \n 13e5c0ceb5f8 Pull complete \n 6a10ed6def1e Extracting 1 s\n 6a10ed6def1e Pull complete \n Image yottadb/yottadb-base:latest-master Pulled \n 6a10ed6def1e Pull complete \n Image yottadb/yottadb-base:latest-master Pulled \n Network pakana_default Creating \n Network pakana_default Created \n Volume pakana_yottadb-data Creating \n Volume pakana_yottadb-data Created \n Container pakana-db-init Creating \n Container pakana-db-init Created \n Container pakana-yottadb Creating \n Container pakana-yottadb Created \n Container pakana-db-init Starting \n Container pakana-db-init Started \n Container pakana-db-init Waiting \n Container pakana-db-init Exited \n Container pakana-yottadb Starting \n Container pakana-yottadb Started \n Image caddy:2-alpine Pulling \n 4f4fb700ef54 Pulling fs layer \n e0865e082b52 Pulling fs layer \n 2d35ebdb57d9 Pulling fs layer \n 7e0c27ccfb2b Pulling fs layer \n 311754a576e9 Pulling fs layer \n 24be2089bf55 Download complete \n f2cc31be8a7c Download complete \n 4f4fb700ef54 Download complete \n 2d35ebdb57d9 Downloading [=============>                                     ]  1.049MB/3.802MB\n 7e0c27ccfb2b Download complete \n 311754a576e9 Downloading [=========>                                         ]  3.146MB/15.92MB\n 311754a576e9 Downloading [=======================>                           ]   7.34MB/15.92MB\n e0865e082b52 Download complete \n 2d35ebdb57d9 Downloading [==================================================>]  3.802MB/3.802MB\n 311754a576e9 Downloading [====================================>              ]  11.53MB/15.92MB\n 2d35ebdb57d9 Download complete \n 2d35ebdb57d9 Extracting 1 s\n 311754a576e9 Downloading [==================================================>]  15.92MB/15.92MB\n 311754a576e9 Download complete \n e0865e082b52 Extracting 1 s\n 2d35ebdb57d9 Pull complete \n e0865e082b52 Pull complete \n 7e0c27ccfb2b Pull complete \n 311754a576e9 Extracting 1 s\n 311754a576e9 Extracting 1 s\n 311754a576e9 Extracting 1 s\n 311754a576e9 Extracting 1 s\n 4f4fb700ef54 Pull complete \n 311754a576e9 Pull complete \n Image caddy:2-alpine Pulled \n Image pakana-api-go Building \n Image pakana-core-rust Building \n Image pakana-api-report Building \nDockerfile:23\n\n--------------------\n\n  21 |     \n\n  22 |     # Build Go API\n\n  23 | >>> COPY go.mod go.sum ./\n\n  24 |     RUN go mod download || true\n\n  25 |     COPY . .\n\n--------------------\n\ntarget api-go: failed to solve: failed to compute cache key: failed to calculate checksum of ref go2d8k8udu6rmjgvqg18z8wlq::7mnycxyss9wd2eprrkfuk2z43: \"/go.sum\": not found\n\n"
    }
  ]
}

=== Deployment & Setup Complete ===
You can now connect to your node:
ssh pakanaadmin@pakana-ce-9424e978.westus2.cloudapp.azure.com

To check logs: ssh pakanaadmin@pakana-ce-9424e978.westus2.cloudapp.azure.com 'cd /opt/pakana && docker compose logs -f'
Franklins-MacBook-Air:pakana-node-ce steven$ ssh pakanaadmin@pakana-ce-9424e978.westus2.cloudapp.azure.com
The authenticity of host 'pakana-ce-9424e978.westus2.cloudapp.azure.com (20.9.232.146)' can't be established.
ED25519 key fingerprint is SHA256:s/QUaGgI8v+AJ+NqSTIjZ75HEQwHisI/e4pPu+IOE9E.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added 'pakana-ce-9424e978.westus2.cloudapp.azure.com' (ED25519) to the list of known hosts.
pakanaadmin@pakana-ce-9424e978.westus2.cloudapp.azure.com: Permission denied (publickey).
Franklins-MacBook-Air:pakana-node-ce steven$